@{

    ViewBag.Title = "WCC  | My Bitcoin";
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
}
@model WalletVM
<div id="content" class="content">
    <!-- begin breadcrumb -->
    <ol class="breadcrumb float-xl-right">
        <li class="breadcrumb-item"><a href="javascript:;">Wallet</a></li>
        <li class="breadcrumb-item active">All channels</li>
    </ol>
    <!-- end breadcrumb -->
    <!-- begin page-header -->
    <h1 class="page-header"> Bitcoin wallet <small> </small></h1>

    <div class="row">
        <!-- begin col-6 -->
        <div class="col-xl-6" onclick="location.href='@Url.Action("MyBitcoin", "Wallet")'">
            <!-- begin card -->
            <div class="card border-0 bg-danger text-white mb-3 overflow-hidden">
                <!-- begin card-body -->
                <div class="card-body">
                    <!-- begin row -->
                    <div class="row">
                        <!-- begin col-7 -->
                        <div class="col-xl-7 col-lg-8">
                            <!-- begin title -->
                            <div class="mb-3 text-white ">
                                <b>
                                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                         width="42px" height="42px" viewBox="0 0 42 42" style="enable-background:new 0 0 42 42;color: #fff!important;" xml:space="preserve">
                                    <g>
                                    <path fill="#fff" d="M20.3,21.4l-1,3.8c1.1,0.3,4.8,1.5,5.3-0.7C25.1,22.2,21.3,21.7,20.3,21.4z" />

                                    <path fill="#fff" d="M21.5,16.1l-0.9,3.5c1,0.3,4,1.3,4.5-0.7S22.5,16.4,21.5,16.1z" /><path fill="#fff" d="M32,0H10C4.5,0,0,4.5,0,10v22c0,5.5,4.5,10,10,10h22c5.5,0,10-4.5,10-10V10C42,4.5,37.5,0,32,0z M28.5,18.9
                                                        c-0.2,1.6-1.1,2.3-2.3,2.7c1.6,0.8,2.4,2,1.6,4.2c-0.9,2.6-3.1,2.9-6.1,2.3L21,31l-1.7-0.4l0.7-2.8c-0.5-0.2-0.9-0.3-1.4-0.4
                                                        l-0.7,2.8l-1.7-0.4l0.7-2.9c-0.4-0.1-0.8-0.2-1.2-0.3L13.4,26l0.9-2l1.3,0.3c0.5,0.1,0.7-0.2,0.8-0.4l1.1-4.5c0.1,0,0.1,0,0.2,0
                                                        c-0.1-0.1-0.2-0.1-0.2-0.1l0.8-3.2c0-0.4-0.1-0.8-0.8-1l-1.3-0.3l0.5-1.9l2.4,0.6c0.4,0.1,0.7,0.2,1.1,0.3l0.7-2.8l1.7,0.4
                                                        l-0.7,2.8c0.5,0.1,0.9,0.2,1.4,0.3l0.7-2.8l1.7,0.4L25,14.9C27.2,15.7,28.8,16.8,28.5,18.9z" /></g>
                                           </svg>
                                </b>
                                @*<span class="ml-2">
                                    <i class="fa fa-info-circle" data-toggle="popover" data-trigger="hover" data-title="Total sales" data-placement="top" data-content="Net sales (gross sales minus discounts and returns) plus taxes and shipping. Includes orders from all sales channels."></i>
                                </span>*@
                            </div>
                            <!-- end title -->
                            <!-- begin total-sales -->
                            <div class="row text-truncate">
                                <!-- begin col-6 -->
                                <div class="col-6">
                                    <div class="f-s-12 text-white">BITCOIN WALLET</div>
                                    <div class="f-s-18 m-b-5 f-w-600 p-b-1" data-animation="number" data-value="-">BTC</div>
                                    <div class="progress progress-xs rounded-lg bg-dark-darker m-b-5">
                                        <div class="progress-bar progress-bar-striped rounded-right bg-teal" data-animation="width" data-value="55%" style="width: 0%"></div>
                                    </div>
                                </div>
                                <!-- end col-6 -->
                                <!-- begin col-6 -->
                                <div class="col-6">
                                    <div class="f-s-12 text-white">Balance:</div>
                                    @*<div class="f-s-18 m-b-5 f-w-600 p-b-1"><span data-animation="number" data-value="0.00"> @Html.DisplayFor(model => model.UserWallets.Find(i => i.WalletCode == "BTC").Balance) BTC </font></span></div>*@
                                    <div class="f-s-18 m-b-5 f-w-600 p-b-1"><span data-animation="number" data-value="0.00"> @((decimal)Model.UserWalletAddressTxs.Txrefs.Sum(i => i.Value) / 100000000) BTC </font></span></div>
                                    <div class="progress progress-xs rounded-lg bg-dark-darker m-b-5">
                                        <div class="progress-bar progress-bar-striped rounded-right" data-animation="width" data-value="55%" style="width: 0%"></div>
                                    </div>
                                </div>
                                <!-- end col-6 -->
                            </div>
                            <!-- end total-sales -->
                            <!-- begin percentage -->
                            @*<div class="mb-3 text-grey">
                                <i class="fa fa-caret-up"></i> <span data-animation="number" data-value="00.00">0.00</span>New Visits
                            </div>*@
                            <!-- end percentage -->
                            <!-- begin row -->
                            <div class="row text-truncate">
                                <!-- begin col-6 -->
                                <div class="col-6">
                                    <div class="f-s-12 text-white">Last day</div>
                                    <div class="f-s-18 m-b-5 f-w-600 p-b-1" data-animation="number" data-value="0">+ 0$</div>
                                    <div class="progress progress-xs rounded-lg bg-dark-darker m-b-5">
                                        <div class="progress-bar progress-bar-striped rounded-right bg-teal" data-animation="width" data-value="55%" style="width: 0%"></div>
                                    </div>
                                </div>
                                <!-- end col-6 -->
                                <!-- begin col-6 -->
                                <div class="col-6">
                                    <div class="f-s-12 text-white">0 BTC</div>
                                    <div class="f-s-18 m-b-5 f-w-600 p-b-1"><span data-animation="number" data-value="0.00">@*@Html.DisplayFor(model => model.UserWallets.Find(i => i.WalletCode == "BTC").BalanceFiat) USD</font>*@</span></div>
                                    <div class="f-s-18 m-b-5 f-w-600 p-b-1"><span data-animation="number" data-value="0.00">@((decimal)Model.UserWalletAddressTxs.Txrefs.Sum(i => i.ValueFiat) / 100000000) USD</font></span></div>
                                    <div class="progress progress-xs rounded-lg bg-dark-darker m-b-5">
                                        <div class="progress-bar progress-bar-striped rounded-right" data-animation="width" data-value="55%" style="width: 0%"></div>
                                    </div>
                                </div>
                                <!-- end col-6 -->
                            </div>
                            <!-- end row -->
                        </div> <div class="col-xl-5 col-lg-4 align-items-d d-flex justify-content-end">
                            <img src="~/img/wallet-bg-img-1.png" height="150px" class="d-none d-lg-block" />
                        </div>
                        <!-- end col-7 -->
                        <!-- begin col-5 -->
                        <!-- end col-5 -->
                    </div>
                    <span><b>Wallet number:</b> @Html.DisplayFor(i => i.PaymentAddress)</span>
                    <!-- end row -->
                </div>
                <!-- end card-body -->
            </div>
            <!-- end card -->
        </div>



        <div class="col-xl-2">
            <!-- begin card -->
            <div class="card border-0   text-white mb-3 overflow-hidden" style="background-color:#d9e0e7">
                <!-- begin card-body -->
                <div class="card-body">
                    <!-- begin row -->



                    <span>
                        <button id="send" data-toggle="modal" data-target="#sendModal" class="btn btn-primary">SEND  </button>
                    </span>
                    <!-- end row -->
                </div>
                <div class="card-body">
                    <!-- begin row -->

                    <form onsubmit="GetNewAddress('@Url.Action("NewAddress", "Wallet")','POST',this); return false">

                        <button type="submit" id="receive" data-toggle="modal" data-target="#receiveModal" class="btn btn-primary popup-link">RECEIVE </button>
                        <input style="display:none" type="text" Name="WalletCode" value="@Html.DisplayFor(i => i.WalletCode)">
                    </form>

                    <!-- end row -->
                </div>
                <div class="card-body">
                    <!-- begin row -->



                    <button onclick="location.href='@Url.Action("Index", "Transactions")'" class="btn btn-primary">ALL TRANSACTIONS </button>
                    <!-- end row -->
                </div>
                <!-- end card-body -->
            </div>
            <!-- end card -->
        </div>


        <partial name="PartialsWallet/Transaction.cshtml" />
        <partial name="PartialsWallet/Send.cshtml" />
        <partial name="PartialsWallet/Receive.cshtml" />
        <!-- end card -->
    </div>
</div>

<script type="text/javascript">
    var p, q;

    function showPreload(e) {
        q = e.innerHTML;
        e.innerHTML = "Loading...";
        e.style.opacity = 0.5;
        p = e;
    }

    function CopyPaymentAddressText() {
        /* Get the text field */
        var copyText = document.getElementById("PaymentAddress");

        /* Select the text field */
        copyText.select();
        copyText.setSelectionRange(0, 99999); /*For mobile devices*/

        /* Copy the text inside the text field */
        document.execCommand("copy");

        /* Alert the copied text */
        alert("Address Copied to clipboard.");
    }

    function getFormData(form) {
        var unindexed_array = $(form).serializeArray();
        var indexed_array = {};

        $.map(unindexed_array, function (n, i) {
            indexed_array[n['name']] = n['value'];
        });

        return JSON.stringify(indexed_array);
    }

    function GetNewAddress(url, type, form) {
        if (document.getElementById('PaymentAddress').value == "") {
            $.ajax({
                url: url,
                type: type,
                data: getFormData(form),
                contentType: 'application/json',
                success: function (data) {
                    if (data.Message != undefined) {
                        alert(data.Message);
                    }
                    console.log(data);
                    document.getElementById('spinner').style.display = "none";
                    document.getElementById('PaymentAddress').value = data.Address;
                    document.getElementById('PaymentAddressImg').src = "https://api.qrserver.com/v1/create-qr-code/?size=192x192&data=" + data.Address;
                },
                error: function (data, textStatus, jqXHR) {
                    console.log(data.responseJSON);
                    alert(data.responseJSON.Message);
                    window.location.replace(data.RedirectUrl);
                },
        });
        }



        return false
    }

</script>

